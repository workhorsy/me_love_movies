
<% form_for(title_rating) do |f| %>
	<div id="container">

	<script type="text/javascript" language="JavaScript">
		var IE = document.all ? true : false;
		var mouse_x = 0;
		var mouse_y = 0;
		var star_on = "<img src=\"/images/heart_on.jpg\" />";
		var star_off = "<img src=\"/images/heart_off.jpg\" />";
		var star_max = 5;
		var image_width = 20;

		setInterval(check_mouse_off, 125);

		var id_rects = [];
		function check_mouse_off() {
			for(i=0; i<id_rects.length; i++) {
				c = $(id_rects[i]);
				if(!(mouse_x >= c.offsetLeft && mouse_x <= (c.offsetLeft + c.offsetWidth) &&
					mouse_y >= c.offsetTop && mouse_y <= (c.offsetTop + c.offsetHeight))) {
					var newHTML = star_off;
					var count = parseInt($(id_rects[i] + '_value').value);
					for(j=0; j<count; j++) {
						newHTML += star_on;
					}
					for(j=0; j<star_max-count; j++) {
						newHTML += star_off;
					}
					c.innerHTML = newHTML;
				}
			}
		}

		container = $('container');
		container.onmousemove = function(e) {
			var tempX = 0;
			var tempY = 0;
			if (IE) { // grab the x-y pos.s if browser is IE
				tempX = e.clientX + document.body.scrollLeft;
				tempY = e.clientY + document.body.scrollTop;
			} else {  // grab the x-y pos.s if browser is NS
				tempX = e.pageX;
				tempY = e.pageY;
			}

			mouse_x = tempX;
			mouse_y = tempY;
		}
	</script>

	<fieldset>
		<legend>Genre</legend>
		<% for genre in Title::genres %>
		<% n = Title::genres.index(genre) %>
		<div id="genre_<%=n%>_container"
				class="title_rating_attribute">
			<input id="genre_<%=n%>_value" type="hidden" value="0" />
			<span id="genre_<%=n%>">
				<%= image_tag('heart_off.jpg') * 6 %>
			</span>
			<b><%= genre.gsub('_', ' ').capitalize %></b>
		</div>
		<script type="text/javascript" language="JavaScript">
		id_rects.push('genre_<%=n%>');

		$('genre_<%=n%>').onclick = function() {
			var value = $('genre_<%=n%>_value');
			var control = $('genre_<%=n%>');
			var on_count = control.innerHTML.split('on').length-1;
			value.value = on_count;
		}

		$('genre_<%=n%>').onmousemove = function(e) {
			var control = $('genre_<%=n%>');
			var tempX = 0;
			var tempY = 0;
			if (IE) { // grab the x-y pos.s if browser is IE
				tempX = e.clientX + document.body.scrollLeft;
				tempY = e.clientY + document.body.scrollTop;
			} else {  // grab the x-y pos.s if browser is NS
				tempX = e.pageX;
				tempY = e.pageY;
			}
			tempX -= control.offsetLeft;
			tempY -= control.offsetTop;

			var star_count = parseInt(tempX / image_width);
			if(star_count > star_max) star_count = 0;

			var content = star_off;
			for(i=0; i<star_count; i++) {
				content += star_on;
			}
			for(i=0; i<star_max-star_count; i++) {
				content += star_off;
			}
			control.innerHTML = content;
		}
		</script>
		<% end %>
	</fieldset>

	<fieldset>
		<legend>Attributes</legend>
		<% for attribute in Title::attributes %>
		<% n = Title::attributes.index(attribute) %>
		<div id="attribute_<%=n%>_container"
				class="title_rating_attribute">
			<input id="attribute_<%=n%>_value" type="hidden" value="0" />
			<span id="attribute_<%=n%>">
				<%= image_tag('heart_off.jpg') * 6 %>
			</span>
			<b><%= attribute.gsub('_', ' ').capitalize %></b>
		</div>
		<script type="text/javascript" language="JavaScript">
		id_rects.push('attribute_<%=n%>');

		$('attribute_<%=n%>').onclick = function() {
			var value = $('attribute_<%=n%>_value');
			var control = $('attribute_<%=n%>');
			var on_count = control.innerHTML.split('on').length-1;
			value.value = on_count;
		}

		$('attribute_<%=n%>').onmousemove = function(e) {
			var control = $('attribute_<%=n%>');
			var tempX = 0;
			var tempY = 0;
			if (IE) { // grab the x-y pos.s if browser is IE
				tempX = e.clientX + document.body.scrollLeft;
				tempY = e.clientY + document.body.scrollTop;
			} else {  // grab the x-y pos.s if browser is NS
				tempX = e.pageX;
				tempY = e.pageY;
			}
			tempX -= control.offsetLeft;
			tempY -= control.offsetTop;

			var star_count = parseInt(tempX / image_width);
			if(star_count > star_max) star_count = 0;

			var content = star_off;
			for(i=0; i<star_count; i++) {
				content += star_on;
			}
			for(i=0; i<star_max-star_count; i++) {
				content += star_off;
			}
			control.innerHTML = content;
		}
		</script>
		<% end %>
	</fieldset>
	</div>

	<%= f.hidden_field :title_id, :value => title_rating.title_id %>

	<p>
		<%= f.submit button_name %>
	</p>
<% end %>
